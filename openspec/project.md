# Project Context

## Purpose
AI家教软件 (AITutor) 是一个基于Web的智能个人学习辅助平台，为学生和教育工作者提供个性化学习指导、知识问答和AI对话服务。系统支持多模态输入（文本、图片、文档等），提供智能对话功能、知识管理系统和学习数据分析。采用前后端分离架构，前端为单页应用，后端提供RESTful API服务。

## Tech Stack

### Frontend (前端技术栈)
- **核心框架**: 原生 HTML5, CSS3, JavaScript (ES6+)
- **UI框架**: Bootstrap 5 (响应式布局)
- **图标库**: Font Awesome 6.0
- **代码高亮**: Prism.js 1.29.0 (支持多语言语法高亮)
- **设计模式**: 单页应用(SPA)，模块化组件架构
- **CSS架构**: BEM命名规范，CSS变量主题系统
- **前端存储**: localStorage (用户会话)，本地文件系统

### Backend (后端技术栈)
- **运行环境**: Node.js (>=14.0.0)
- **Web框架**: Express.js 4.18.2
- **文件上传**: Multer 1.4.5-lts.1
- **跨域支持**: CORS 2.8.5
- **HTTP客户端**: node-fetch 3.3.2
- **开发工具**: nodemon 3.0.1 (热重载)

### AI集成服务
- **主要AI提供商**: 智谱AI GLM API
  - 模型支持: glm-4 (文本对话), glm-4v (视觉理解), glm-4-plus, glm-4v-plus
  - API端点: https://open.bigmodel.cn/api/paas/v4/chat/completions
- **备选AI提供商**: 豆包 Vision API (图像识别优化)
- **多模态支持**: 文本对话、图像理解、OCR识别、文档解析

### 数据存储架构
- **文件系统存储**: 本地uploads目录
- **数据持久化**: JSON文件存储 (conversations, favorites)
- **临时存储**: 内存缓存，Base64编码
- **数据管理**: DataStore类 (统一数据访问接口)

### 开发和部署工具
- **包管理**: npm (Node Package Manager)
- **代码管理**: Git (版本控制)
- **开发模式**: nodemon (自动重启开发服务器)
- **测试框架**: Node.js原生测试 + 手动浏览器测试
- **端口配置**: 开发环境 3000，支持跨域访问

## Project Conventions

### Code Style (代码风格)

#### JavaScript 规范
- **语法标准**: ES6+ 现代JavaScript语法，使用 const/let 优先于 var
- **函数风格**: 函数表达式和箭头函数混合使用，优先使用箭头函数
- **变量命名**: 驼峰命名法 (camelCase)，语义化命名，避免单字母变量名
- **模块化**: 使用ES6模块导入导出，按功能拆分代码文件
- **异步处理**: Promise/async-await 模式，避免回调地狱
- **错误处理**: try-catch 结构，优雅的错误提示和日志记录
- **代码注释**: 中文注释为主，关键函数和复杂逻辑需要详细注释
- **代码格式**: 4空格缩进，避免使用制表符，使用Prettier格式化

#### CSS 规范
- **命名方法**: BEM (Block__Element--Modifier) 命名规范
- **CSS变量**: 使用CSS自定义属性进行主题配置和颜色管理
- **响应式设计**: 移动优先的Media Query策略
- **组件化**: 按功能模块划分CSS文件，避免全局样式污染
- **选择器优化**: 避免过深嵌套，使用语义化类名
- **动画效果**: CSS3 transitions和animations，性能优先

#### HTML 规范
- **语义化标签**: 合理使用HTML5语义化元素
- **无障碍访问**: 添加aria标签支持屏幕阅读器
- **SEO优化**: 合理的meta标签和文档结构
- **表单验证**: HTML5原生验证 + JavaScript增强

### Architecture Patterns (架构模式)

#### 前端架构
- **单页应用(SPA)**: 通过JavaScript动态渲染页面，避免页面刷新
- **组件化设计**: 按功能划分前端组件，可复用性优先
- **状态管理**: 使用全局变量管理应用状态，事件驱动更新
- **路由管理**: 基于hash的简单路由系统
- **模块化加载**: 动态加载JavaScript模块和CSS样式

#### 后端架构
- **RESTful API**: 标准HTTP方法，语义化URL设计
- **中间件模式**: Express.js中间件处理认证、日志、错误处理
- **文件处理**: Multer处理文件上传，支持多格式文件
- **错误处理**: 统一错误响应格式，详细错误日志
- **API文档**: 接口文档和示例代码

#### 数据架构
- **文件存储**: 基于本地文件系统的数据存储
- **JSON格式**: 统一的数据交换格式
- **数据模型**: Conversation, User, Favorite等核心数据模型
- **缓存策略**: 内存缓存 + localStorage客户端缓存

#### 通信协议
- **HTTP/HTTPS**: 标准Web通信协议
- **CORS配置**: 跨域资源共享配置
- **JSON API**: 前后端数据交换格式
- **WebSocket**: 实时通信(预留接口)

### Testing Strategy (测试策略)

#### 自动化测试
- **API单元测试**: Node.js原生测试脚本，验证后端接口功能
- **模块测试**: 各JavaScript模块的独立功能测试
- **文件处理测试**: 图片上传、Base64编码、文件大小限制
- **错误处理测试**: 网络异常、API限制、文件格式验证

#### 手动测试
- **功能测试**: 通过HTML页面验证完整用户流程
- **用户体验测试**: 界面交互、响应速度、易用性评估
- **AI对话测试**: GLM API集成、多轮对话、上下文理解
- **多模态测试**: 图片识别、文档解析、语音输入功能

#### 兼容性测试
- **跨浏览器测试**: Chrome、Firefox、Safari、Edge主流浏览器
- **响应式测试**: 桌面、平板、手机不同屏幕尺寸适配
- **设备测试**: Windows、macOS、Linux、iOS、Android平台

#### 性能测试
- **API响应时间**: 目标3秒内响应，用户体验优先
- **文件上传性能**: 大文件处理和进度显示
- **内存使用**: 长时间使用的内存泄漏检测
- **并发测试**: 多用户同时使用的系统稳定性

### Git Workflow (Git工作流)

#### 分支策略
- **main分支**: 生产环境代码，保持稳定状态，只接受merge
- **develop分支**: 开发环境，集成新功能和bug修复
- **feature分支**: feature/功能名称，用于开发新功能
- **hotfix分支**: hotfix/问题描述，用于紧急生产bug修复
- **release分支**: release/版本号，用于发布准备和测试

#### 提交规范 (Conventional Commits)
- **feat**: 新功能添加 (feature)
- **fix**: bug修复 (bug fix)
- **docs**: 文档更新 (documentation)
- **style**: 代码格式调整，不影响功能 (formatting, missing semi colons, etc)
- **refactor**: 代码重构，既不是新增功能也不是修复bug
- **test**: 测试相关 (adding missing tests, refactoring test)
- **chore**: 构建/工具链更新 (updating build tasks, package manager configs, etc)
- **perf**: 性能优化 (performance improvements)
- **ci**: CI配置文件和脚本的变动 (continuous integration)

#### 提交消息格式
```
type(scope): description

feat(ai): 添加GLM API视觉理解支持
fix(upload): 修复大图片上传内存溢出问题
docs(readme): 更新API使用文档
style(ui): 调整消息气泡样式
```

## Domain Context (领域背景)

#### AI教育技术
- **智能家教系统**: 基于大语言模型的个性化学习助手
- **多模态AI理解**: 集成文本对话、图像识别、文档解析能力
- **自适应学习**: 根据用户水平和进度调整教学内容和难度
- **Socratic教学法**: 引导式提问，激发学生思考和学习主动性

#### 教育场景应用
- **学科覆盖**: 数学、物理、化学、语文、英语、历史等主要学科
- **题目识别**: 支持拍照上传题目，自动OCR识别和内容解析
- **知识点关联**: 构建学科知识图谱，智能推荐相关学习内容
- **作业辅导**: 提供解题思路、方法指导和知识点讲解
- **学习评估**: 用户学习行为追踪，学习效果分析和建议

#### 目标用户群体
- **学生群体**: 小学到大学不同年龄段学生
- **成人学习者**: 职业教育和终身学习需求
- **教育工作者**: 教师、家长辅助教学工具
- **特殊教育**: 为有特殊学习需求的学生提供支持

#### 中文教育特色
- **中文教学场景**: 专门优化中文题目理解和解答
- **本地化内容**: 适配中国教育大纲和考试要求
- **文化适应性**: 理解中文学习习惯和教育文化背景
- **多语言支持**: 支持中英文双语学习和切换

## Important Constraints (重要约束)

#### API服务限制
- **配额管理**: GLM API有调用频率(每分钟请求数)和token数量限制，需要实现请求队列和重试机制
- **响应时间**: API响应时间控制在3秒以内，超时需要用户友好的错误提示
- **模型切换**: 支持多个AI模型(GLM-4、豆包Vision等)，需要智能负载均衡和故障转移
- **成本控制**: API调用成本实时监控，设置使用量预警和预算限制

#### 文件处理约束
- **文件大小**: 图片上传限制10MB，文档文件限制20MB
- **文件格式**: 支持JPG、PNG、GIF、WebP图片格式；PDF、DOCX、PPTX文档格式
- **并发上传**: 最多同时处理5个文件，需要队列管理
- **存储管理**: 本地存储空间监控，定期清理过期文件
- **安全扫描**: 文件上传前进行恶意软件检测

#### 性能和扩展性
- **并发用户**: 支持100+并发用户同时使用
- **内存管理**: 前端内存使用控制在100MB以内，防止内存泄漏
- **缓存策略**: 合理使用浏览器缓存和localStorage缓存
- **数据库优化**: JSON文件存储的读写性能优化

#### 安全和合规
- **数据隐私**: 用户对话记录和上传文件加密存储，定期自动清理
- **内容安全**: AI生成内容需要过滤敏感信息，符合教育法规
- **访问控制**: 实现用户认证和权限管理
- **API安全**: API密钥安全存储，防止前端泄露

#### 技术兼容性
- **浏览器支持**: Chrome 80+、Firefox 75+、Safari 13+、Edge 80+
- **设备适配**: 响应式设计支持桌面、平板、手机
- **网络环境**: 支持弱网环境，提供离线基础功能
- **系统依赖**: 最低Node.js 14.0.0运行环境

## External Dependencies (外部依赖)

#### AI服务提供商
- **智谱AI GLM API** (主要服务)
  - 模型支持: glm-4 (文本对话)、glm-4v (视觉理解)、glm-4-plus、glm-4v-plus
  - API端点: https://open.bigmodel.cn/api/paas/v4/chat/completions
  - 认证方式: API Key (服务端配置)
  - 支持功能: 多轮对话、图像理解、上下文管理

- **豆包Vision API** (备选服务)
  - 优势: 图像识别优化，中文场景增强
  - 用途: 图片题目识别、OCR处理
  - 故障转移: GLM API不可用时自动切换

#### 前端CDN资源
- **Font Awesome 6.0**: 图标字体库，提供丰富的界面图标
- **Prism.js 1.29.0**: 代码语法高亮引擎，支持100+编程语言
- **Bootstrap 5.3**: 响应式CSS框架，提供UI组件和网格系统
- **CDN优化**: 使用国内CDN加速资源加载，支持HTTP/2

#### Node.js生态依赖
- **核心框架**:
  - express ^4.18.2: Web应用服务器框架
  - multer ^1.4.5-lts.1: 文件上传中间件
  - cors ^2.8.5: 跨域资源共享中间件
  - node-fetch ^3.3.2: 现代HTTP客户端

- **开发工具**:
  - nodemon ^3.0.1: 开发时自动重启服务器
  - 可选: jest (单元测试)、eslint (代码检查)、prettier (代码格式化)

#### 系统运行环境
- **服务端要求**:
  - Node.js >= 14.0.0 (推荐 LTS 版本)
  - 内存: 最低512MB，推荐2GB+
  - 存储: 最低1GB可用空间
  - 网络: 稳定的互联网连接访问AI API

- **客户端要求**:
  - 现代浏览器，支持ES6+语法和Fetch API
  - 内存: 最低2GB可用内存
  - 网络: 宽带互联网连接
  - 屏幕分辨率: 最低1024x768，推荐1920x1080+

#### 数据存储和备份
- **本地文件系统**: uploads目录、data目录的JSON数据文件
- **数据备份**: 定期备份用户数据和对话记录
- **日志管理**: 应用日志、错误日志、API调用日志
- **临时文件**: Base64缓存、上传临时文件的自动清理机制
